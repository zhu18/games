<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>手机性能检测工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <script src="../js/chart.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        success: '#10B981',
                        warning: '#F59E0B',
                        danger: '#EF4444',
                        purple: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .test-card {
                @apply bg-white rounded-xl shadow-md p-5 transition-all duration-300 hover:shadow-lg;
            }
            .pulse {
                animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }
            .progress-bar {
                @apply h-2 bg-gray-200 rounded-full overflow-hidden;
            }
            .progress-value {
                @apply h-full transition-all duration-500 ease-out;
            }
            .result-badge {
                @apply px-3 py-1 rounded-full text-xs font-medium;
            }
            .gpu-canvas-container {
                @apply w-full h-40 mb-3 rounded-lg overflow-hidden border border-gray-200;
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans text-dark">
    <!-- 顶部导航 -->
    <nav class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-microchip text-primary text-xl"></i>
                <h1 class="text-xl font-bold">手机性能检测</h1>
            </div>
            <button id="infoBtn" class="p-2 rounded-full hover:bg-gray-100 transition-colors">
                <i class="fa fa-info text-gray-600"></i>
            </button>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-6">
        <!-- 检测状态概览 -->
        <div class="bg-gradient-to-r from-primary to-blue-600 text-white rounded-2xl p-6 mb-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <div>
                    <h2 class="text-2xl font-bold mb-2">性能检测</h2>
                    <p class="text-blue-100 mb-4 md:mb-0">全面评估您的设备性能，包括CPU、内存、显卡、网络和电池</p>
                </div>
                <button id="startTestBtn" class="bg-white text-primary font-medium px-6 py-3 rounded-lg shadow-md hover:bg-gray-100 transition-all transform hover:scale-105 active:scale-95 flex items-center">
                    <i class="fa fa-play mr-2"></i> 开始检测
                </button>
            </div>
        </div>

        <!-- 检测结果概览 -->
        <div id="resultSummary" class="hidden mb-6">
            <div class="bg-white rounded-xl shadow-md p-5">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fa fa-tachometer text-primary mr-2"></i> 性能评分
                </h3>
                <div class="flex flex-col md:flex-row items-center justify-between">
                    <div class="mb-4 md:mb-0">
                        <div class="text-4xl font-bold text-primary mb-1" id="totalScore">0</div>
                        <div class="text-gray-500" id="scoreDesc">点击开始检测评估设备性能</div>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-5 gap-4 w-full md:w-auto">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-primary mb-1" id="cpuScore">0</div>
                            <div class="text-xs text-gray-500">CPU性能</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-primary mb-1" id="memoryScore">0</div>
                            <div class="text-xs text-gray-500">内存性能</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-purple mb-1" id="gpuScore">0</div>
                            <div class="text-xs text-gray-500">显卡性能</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-primary mb-1" id="networkScore">0</div>
                            <div class="text-xs text-gray-500">网络速度</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-primary mb-1" id="batteryScore">0</div>
                            <div class="text-xs text-gray-500">电池状态</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 检测项目 -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- CPU性能测试 -->
            <div class="test-card">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fa fa-microchip text-primary"></i>
                        </div>
                        <h3 class="font-semibold">CPU性能测试</h3>
                    </div>
                    <span id="cpuStatus" class="result-badge bg-gray-100 text-gray-600">未检测</span>
                </div>
                
                <div id="cpuTestContent">
                    <p class="text-sm text-gray-600 mb-4">通过计算复杂任务评估CPU处理能力</p>
                    <div class="progress-bar">
                        <div id="cpuProgress" class="progress-value bg-primary" style="width: 0%"></div>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span class="text-gray-500">核心数:</span>
                            <span id="cpuCores" class="font-medium">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">计算速度:</span>
                            <span id="cpuSpeed" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                
                <div id="cpuTesting" class="hidden">
                    <div class="flex justify-center items-center py-4">
                        <div class="text-center">
                            <div class="inline-block w-8 h-8 border-2 border-primary border-t-transparent rounded-full  animate-spin mb-2"></div>
                            <p class="text-sm text-gray-600">正在测试CPU性能...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 内存性能测试 -->
            <div class="test-card">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fa fa-microchip text-success"></i>
                        </div>
                        <h3 class="font-semibold">内存性能测试</h3>
                    </div>
                    <span id="memoryStatus" class="result-badge bg-gray-100 text-gray-600">未检测</span>
                </div>
                
                <div id="memoryTestContent">
                    <p class="text-sm text-gray-600 mb-4">测试内存读写速度和可用空间</p>
                    <div class="progress-bar">
                        <div id="memoryProgress" class="progress-value bg-success" style="width: 0%"></div>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span class="text-gray-500">可用内存:</span>
                            <span id="availableMemory" class="font-medium">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">内存速度:</span>
                            <span id="memorySpeed" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                
                <div id="memoryTesting" class="hidden">
                    <div class="flex justify-center items-center py-4">
                        <div class="text-center">
                            <div class="inline-block w-8 h-8 border-2 border-success border-t-transparent rounded-full  animate-spin mb-2"></div>
                            <p class="text-sm text-gray-600">正在测试内存性能...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 显卡性能测试 -->
            <div class="test-card">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fa fa-picture-o text-purple"></i>
                        </div>
                        <h3 class="font-semibold">显卡性能测试</h3>
                    </div>
                    <span id="gpuStatus" class="result-badge bg-gray-100 text-gray-600">未检测</span>
                </div>
                
                <div id="gpuTestContent">
                    <p class="text-sm text-gray-600 mb-3">测试图形渲染能力和3D性能</p>
                    <div class="gpu-canvas-container">
                        <canvas id="gpuCanvas" class="w-full h-full"></canvas>
                    </div>
                    <div class="progress-bar">
                        <div id="gpuProgress" class="progress-value bg-purple" style="width: 0%"></div>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span class="text-gray-500">帧率:</span>
                            <span id="gpuFps" class="font-medium">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">渲染性能:</span>
                            <span id="gpuRenderPerformance" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                
                <div id="gpuTesting" class="hidden">
                    <div class="flex justify-center items-center py-4">
                        <div class="text-center">
                            <div class="inline-block w-8 h-8 border-2 border-purple border-t-transparent rounded-full  animate-spin mb-2"></div>
                            <p class="text-sm text-gray-600">正在测试显卡性能...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 网络速度测试 -->
            <div class="test-card">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fa fa-wifi text-warning"></i>
                        </div>
                        <h3 class="font-semibold">网络速度测试</h3>
                    </div>
                    <span id="networkStatus" class="result-badge bg-gray-100 text-gray-600">未检测</span>
                </div>
                
                <div id="networkTestContent">
                    <p class="text-sm text-gray-600 mb-4">测试下载和上传速度及网络延迟</p>
                    <div class="progress-bar">
                        <div id="networkProgress" class="progress-value bg-warning" style="width: 0%"></div>
                    </div>
                    <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span class="text-gray-500">下载速度:</span>
                            <span id="downloadSpeed" class="font-medium">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">延迟:</span>
                            <span id="networkLatency" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                
                <div id="networkTesting" class="hidden">
                    <div class="flex justify-center items-center py-4">
                        <div class="text-center">
                            <div class="inline-block w-8 h-8 border-2 border-warning border-t-transparent rounded-full  animate-spin mb-2"></div>
                            <p class="text-sm text-gray-600">正在测试网络速度...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 电池状态测试 -->
            <div class="test-card md:col-span-2">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center mr-3">
                            <i class="fa fa-battery-full text-danger"></i>
                        </div>
                        <h3 class="font-semibold">电池状态测试</h3>
                    </div>
                    <span id="batteryStatus" class="result-badge bg-gray-100 text-gray-600">未检测</span>
                </div>
                
                <div id="batteryTestContent">
                    <p class="text-sm text-gray-600 mb-4">检测电池电量、健康状态和充电情况</p>
                    <div class="progress-bar">
                        <div id="batteryProgress" class="progress-value bg-danger" style="width: 0%"></div>
                    </div>
                    <div class="mt-3 grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm">
                        <div>
                            <span class="text-gray-500">电量:</span>
                            <span id="batteryLevel" class="font-medium">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">状态:</span>
                            <span id="batteryState" class="font-medium">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">估算续航:</span>
                            <span id="batteryEstimate" class="font-medium">-</span>
                        </div>
                        <div>
                            <span class="text-gray-500">健康状态:</span>
                            <span id="batteryHealth" class="font-medium">-</span>
                        </div>
                    </div>
                </div>
                
                <div id="batteryTesting" class="hidden">
                    <div class="flex justify-center items-center py-4">
                        <div class="text-center">
                            <div class="inline-block w-8 h-8 border-2 border-danger border-t-transparent rounded-full  animate-spin mb-2"></div>
                            <p class="text-sm text-gray-600">正在检测电池状态...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 性能图表 -->
        <div id="performanceChartContainer" class="bg-white rounded-xl shadow-md p-5 mb-6 hidden">
            <h3 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fa fa-line-chart text-primary mr-2"></i> 性能分析
            </h3>
            <div class="h-64">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>

        <!-- 设备信息 -->
        <div class="bg-white rounded-xl shadow-md p-5 mb-6">
            <h3 class="text-lg font-semibold mb-4 flex items-center">
                <i class="fa fa-mobile text-primary mr-2 text-2xl"></i> 设备信息
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">设备型号:</span>
                    <span id="deviceModel" class="font-medium">未知</span>
                </div>
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">操作系统:</span>
                    <span id="osVersion" class="font-medium">未知</span>
                </div>
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">浏览器:</span>
                    <span id="browserInfo" class="font-medium">未知</span>
                </div>
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">屏幕分辨率:</span>
                    <span id="screenResolution" class="font-medium">未知</span>
                </div>
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">CPU核心数:</span>
                    <span id="deviceCores" class="font-medium">未知</span>
                </div>
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">GPU信息:</span>
                    <span id="gpuInfo" class="font-medium">未知</span>
                </div>
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">网络类型:</span>
                    <span id="networkType" class="font-medium">未知</span>
                </div>
                <div class="flex justify-between py-1 border-b border-gray-100">
                    <span class="text-gray-500">WebGL版本:</span>
                    <span id="webglVersion" class="font-medium">未知</span>
                </div>
            </div>
        </div>
    </main>

    <!-- 信息弹窗 -->
    <div id="infoModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl w-full max-w-md mx-4 p-6 transform transition-all scale-95 opacity-0" id="modalContent">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">检测说明</h3>
                <button id="closeInfoModal" class="text-gray-400 hover:text-gray-600">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="space-y-3 text-sm">
                <p><i class="fa fa-info-circle text-primary mr-2"></i> 性能检测将评估您设备的CPU、内存、显卡、网络和电池状态</p>
                <p><i class="fa fa-clock-o text-primary mr-2"></i> 完整检测过程大约需要45-75秒，请保持页面在前台</p>
                <p><i class="fa fa-picture-o text-purple mr-2"></i> 显卡测试会进行图形渲染，可能会使设备短暂发热</p>
                <p><i class="fa fa-wifi text-primary mr-2"></i> 网络测试会消耗少量流量，建议在WiFi环境下进行</p>
                <p><i class="fa fa-battery-half text-primary mr-2"></i> 电池测试需要浏览器支持Battery API</p>
                <p><i class="fa fa-tachometer text-primary mr-2"></i> 最终评分基于各项测试结果综合计算得出</p>
            </div>
            <button id="startFromModalBtn" class="w-full mt-6 bg-primary text-white font-medium py-2.5 rounded-lg hover:bg-primary/90 transition-all">
                开始检测
            </button>
        </div>
    </div>

    <!-- 底部 -->
    <footer class="bg-gray-800 text-white py-6">
        <div class="container mx-auto px-4 text-center text-sm text-gray-400">
            <p>手机性能检测工具 © 2024</p>
            <p class="mt-1">检测结果仅供参考，不代表设备真实硬件参数</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM元素
            const startTestBtn = document.getElementById('startTestBtn');
            const startFromModalBtn = document.getElementById('startFromModalBtn');
            const infoBtn = document.getElementById('infoBtn');
            const infoModal = document.getElementById('infoModal');
            const closeInfoModal = document.getElementById('closeInfoModal');
            const modalContent = document.getElementById('modalContent');
            
            // 测试状态元素
            const cpuStatus = document.getElementById('cpuStatus');
            const memoryStatus = document.getElementById('memoryStatus');
            const gpuStatus = document.getElementById('gpuStatus');
            const networkStatus = document.getElementById('networkStatus');
            const batteryStatus = document.getElementById('batteryStatus');
            
            // 测试内容和进度元素
            const cpuTestContent = document.getElementById('cpuTestContent');
            const cpuTesting = document.getElementById('cpuTesting');
            const cpuProgress = document.getElementById('cpuProgress');
            
            const memoryTestContent = document.getElementById('memoryTestContent');
            const memoryTesting = document.getElementById('memoryTesting');
            const memoryProgress = document.getElementById('memoryProgress');
            
            const gpuTestContent = document.getElementById('gpuTestContent');
            const gpuTesting = document.getElementById('gpuTesting');
            const gpuProgress = document.getElementById('gpuProgress');
            const gpuCanvas = document.getElementById('gpuCanvas');
            const gpuFps = document.getElementById('gpuFps');
            const gpuRenderPerformance = document.getElementById('gpuRenderPerformance');
            
            const networkTestContent = document.getElementById('networkTestContent');
            const networkTesting = document.getElementById('networkTesting');
            const networkProgress = document.getElementById('networkProgress');
            
            const batteryTestContent = document.getElementById('batteryTestContent');
            const batteryTesting = document.getElementById('batteryTesting');
            const batteryProgress = document.getElementById('batteryProgress');
            
            // 结果元素
            const resultSummary = document.getElementById('resultSummary');
            const totalScore = document.getElementById('totalScore');
            const scoreDesc = document.getElementById('scoreDesc');
            const cpuScore = document.getElementById('cpuScore');
            const memoryScore = document.getElementById('memoryScore');
            const gpuScore = document.getElementById('gpuScore');
            const networkScore = document.getElementById('networkScore');
            const batteryScore = document.getElementById('batteryScore');
            
            // 详细信息元素
            const cpuCores = document.getElementById('cpuCores');
            const cpuSpeed = document.getElementById('cpuSpeed');
            const availableMemory = document.getElementById('availableMemory');
            const memorySpeed = document.getElementById('memorySpeed');
            const downloadSpeed = document.getElementById('downloadSpeed');
            const networkLatency = document.getElementById('networkLatency');
            const batteryLevel = document.getElementById('batteryLevel');
            const batteryState = document.getElementById('batteryState');
            const batteryEstimate = document.getElementById('batteryEstimate');
            const batteryHealth = document.getElementById('batteryHealth');
            
            // 设备信息元素
            const deviceModel = document.getElementById('deviceModel');
            const osVersion = document.getElementById('osVersion');
            const browserInfo = document.getElementById('browserInfo');
            const screenResolution = document.getElementById('screenResolution');
            const deviceCores = document.getElementById('deviceCores');
            const gpuInfo = document.getElementById('gpuInfo');
            const networkType = document.getElementById('networkType');
            const webglVersion = document.getElementById('webglVersion');
            
            // 图表相关
            const performanceChartContainer = document.getElementById('performanceChartContainer');
            let performanceChart = null;
            
            // 显卡测试相关变量
            let gpuTestFrameCount = 0;
            let gpuTestLastTime = 0;
            let gpuTestAnimationId = null;
            let gpuTestObjects = [];
            let gpuCanvasCtx = null;
            
            // 测试结果数据
            const testResults = {
                cpu: { score: 0, cores: 0, speed: 0 },
                memory: { score: 0, available: 0, speed: 0 },
                gpu: { score: 0, fps: 0, performance: 0 },
                network: { score: 0, download: 0, latency: 0 },
                battery: { score: 0, level: 0, state: '', estimate: '', health: '' }
            };
            
            // 初始化设备信息
            initDeviceInfo();
            initGpuCanvas();
            
            // 打开信息弹窗
            infoBtn.addEventListener('click', () => {
                infoModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100', 'transition-all', 'duration-300');
                }, 50);
            });
            
            // 关闭信息弹窗
            closeInfoModal.addEventListener('click', () => {
                modalContent.classList.remove('scale-100', 'opacity-100');
                modalContent.classList.add('scale-95', 'opacity-0', 'transition-all', 'duration-300');
                setTimeout(() => {
                    infoModal.classList.add('hidden');
                }, 300);
            });
            
            // 点击弹窗外部关闭
            infoModal.addEventListener('click', (e) => {
                if (e.target === infoModal) {
                    closeInfoModal.click();
                }
            });
            
            // 开始测试按钮事件
            startTestBtn.addEventListener('click', startTests);
            startFromModalBtn.addEventListener('click', () => {
                closeInfoModal.click();
                setTimeout(startTests, 300);
            });
            
            // 初始化设备信息
            function initDeviceInfo() {
                // 设备型号 (浏览器无法直接获取，只能估算)
                const userAgent = navigator.userAgent;
                let model = "未知";
                
                if (userAgent.match(/iPhone/i)) {
                    model = "iPhone";
                } else if (userAgent.match(/iPad/i)) {
                    model = "iPad";
                } else if (userAgent.match(/Android/i)) {
                    model = "Android设备";
                } else if (userAgent.match(/Windows Phone/i)) {
                    model = "Windows Phone";
                }
                
                deviceModel.textContent = model;
                
                // 操作系统
                let os = "未知";
                if (userAgent.match(/Windows/i)) {
                    os = "Windows";
                } else if (userAgent.match(/Mac OS/i)) {
                    os = "macOS";
                } else if (userAgent.match(/iPhone|iPad|iPod/i)) {
                    os = "iOS";
                } else if (userAgent.match(/Android/i)) {
                    os = "Android";
                }
                
                osVersion.textContent = os;
                
                // 浏览器信息
                let browser = "未知";
                if (userAgent.match(/Chrome/i)) {
                    browser = "Chrome";
                } else if (userAgent.match(/Safari/i) && !userAgent.match(/Chrome/i)) {
                    browser = "Safari";
                } else if (userAgent.match(/Firefox/i)) {
                    browser = "Firefox";
                } else if (userAgent.match(/Edge/i)) {
                    browser = "Edge";
                }
                
                browserInfo.textContent = browser;
                
                // 屏幕分辨率
                const screenWidth = window.screen.width;
                const screenHeight = window.screen.height;
                screenResolution.textContent = `${screenWidth} × ${screenHeight}`;
                
                // CPU核心数
                const cores = navigator.hardwareConcurrency || "未知";
                deviceCores.textContent = cores;
                cpuCores.textContent = cores;
                
                // GPU信息
                getGpuInfo();
                
                // 网络类型
                updateNetworkType();
                window.addEventListener('online', updateNetworkType);
                window.addEventListener('offline', updateNetworkType);
            }
            
            // 获取GPU信息
            function getGpuInfo() {
                try {
                    const canvas = document.createElement('canvas');
                    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                    
                    if (gl) {
                        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                        if (debugInfo) {
                            const vendor = gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
                            const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
                            gpuInfo.textContent = renderer.substring(0, 30) + (renderer.length > 30 ? '...' : '');
                        } else {
                            gpuInfo.textContent = "无法识别";
                        }
                        
                        // WebGL版本
                        webglVersion.textContent = gl.getParameter(gl.VERSION);
                    } else {
                        gpuInfo.textContent = "不支持WebGL";
                        webglVersion.textContent = "不支持";
                    }
                } catch (e) {
                    gpuInfo.textContent = "获取失败";
                    webglVersion.textContent = "未知";
                }
            }
            
            // 初始化GPU测试画布
            function initGpuCanvas() {
                try {
                    gpuCanvasCtx = gpuCanvas.getContext('2d');
                    resizeGpuCanvas();
                    window.addEventListener('resize', resizeGpuCanvas);
                    
                    // 绘制初始状态
                    clearGpuCanvas();
                    gpuCanvasCtx.fillStyle = '#f3f4f6';
                    gpuCanvasCtx.fillRect(0, 0, gpuCanvas.width, gpuCanvas.height);
                    gpuCanvasCtx.fillStyle = '#9ca3af';
                    gpuCanvasCtx.textAlign = 'center';
                    gpuCanvasCtx.textBaseline = 'middle';
                    gpuCanvasCtx.font = '14px sans-serif';
                    gpuCanvasCtx.fillText('点击开始检测以测试显卡性能', gpuCanvas.width / 2, gpuCanvas.height / 2);
                } catch (e) {
                    console.error('初始化GPU测试画布失败:', e);
                }
            }
            
            // 调整GPU画布大小
            function resizeGpuCanvas() {
                if (!gpuCanvasCtx) return;
                
                const container = gpuCanvas.parentElement;
                const width = container.clientWidth;
                const height = container.clientHeight;
                
                // 设置画布的实际尺寸
                gpuCanvas.width = width;
                gpuCanvas.height = height;
                
                // 清除画布
                clearGpuCanvas();
            }
            
            // 清除GPU画布
            function clearGpuCanvas() {
                if (!gpuCanvasCtx) return;
                gpuCanvasCtx.clearRect(0, 0, gpuCanvas.width, gpuCanvas.height);
            }
            
            // 更新网络类型
            function updateNetworkType() {
                if (!navigator.onLine) {
                    networkType.textContent = "离线";
                    return;
                }
                
                if (navigator.connection) {
                    const type = navigator.connection.effectiveType || "未知";
                    networkType.textContent = type.toUpperCase();
                } else {
                    networkType.textContent = "在线";
                }
            }
            
            // 开始所有测试
            function startTests() {
                // 重置状态
                resetTestState();
                
                // 显示结果摘要
                resultSummary.classList.remove('hidden');
                
                // 依次执行各项测试
                testCPU()
                    .then(() => testMemory())
                    .then(() => testGPU())
                    .then(() => testNetwork())
                    .then(() => testBattery())
                    .then(calculateTotalScore)
                    .then(displayPerformanceChart)
                    .catch(error => {
                        console.error("测试出错:", error);
                        showToast("测试过程中出现错误", "error");
                    });
            }
            
            // 重置测试状态
            function resetTestState() {
                // 重置按钮状态
                startTestBtn.disabled = true;
                startTestBtn.innerHTML = '<i class="fa fa-spinner fa-spin mr-2"></i> 测试中...';
                
                // 重置进度和状态
                [cpuProgress, memoryProgress, gpuProgress, networkProgress, batteryProgress].forEach(progress => {
                    progress.style.width = '0%';
                });
                
                [cpuStatus, memoryStatus, gpuStatus, networkStatus, batteryStatus].forEach(status => {
                    status.className = 'result-badge bg-blue-100 text-blue-700';
                    status.textContent = '测试中';
                });
                
                // 隐藏内容，显示测试状态
                cpuTestContent.classList.add('hidden');
                cpuTesting.classList.remove('hidden');
                
                memoryTestContent.classList.add('hidden');
                memoryTesting.classList.remove('hidden');
                
                gpuTestContent.classList.add('hidden');
                gpuTesting.classList.remove('hidden');
                
                networkTestContent.classList.add('hidden');
                networkTesting.classList.remove('hidden');
                
                batteryTestContent.classList.add('hidden');
                batteryTesting.classList.remove('hidden');
                
                // 重置结果
                [totalScore, cpuScore, memoryScore, gpuScore, networkScore, batteryScore].forEach(score => {
                    score.textContent = '0';
                });
                
                scoreDesc.textContent = '正在进行性能测试...';
                performanceChartContainer.classList.add('hidden');
            }
            
            // CPU性能测试
            function testCPU() {
                return new Promise(resolve => {
                    // 记录开始时间
                    const startTime = performance.now();
                    let iterations = 0;
                    
                    // 执行复杂计算任务
                    function calculate() {
                        // 简单但消耗CPU的计算
                        let result = 0;
                        for (let i = 0; i < 1000000; i++) {
                            result += Math.sqrt(Math.random() * i) * Math.sin(i);
                        }
                        
                        iterations++;
                        const elapsed = performance.now() - startTime;
                        
                        // 更新进度
                        const progress = Math.min(Math.floor((elapsed / 7000) * 100), 100);
                        cpuProgress.style.width = `${progress}%`;
                        
                        // 持续7秒钟的测试
                        if (elapsed < 7000) {
                            requestAnimationFrame(calculate);
                        } else {
                            // 计算得分 (基于迭代次数)
                            const score = Math.min(Math.floor((iterations / 14) * 100), 100);
                            
                            // 保存结果
                            testResults.cpu.score = score;
                            testResults.cpu.speed = `${(iterations / (elapsed / 1000)).toFixed(1)} 次/秒`;
                            
                            // 更新UI
                            cpuScore.textContent = score;
                            cpuSpeed.textContent = testResults.cpu.speed;
                            
                            // 恢复显示
                            cpuTesting.classList.add('hidden');
                            cpuTestContent.classList.remove('hidden');
                            
                            // 更新状态
                            cpuStatus.className = getScoreBadgeClass(score);
                            cpuStatus.textContent = getScoreText(score);
                            
                            showToast("CPU性能测试完成");
                            resolve();
                        }
                    }
                    
                    calculate();
                });
            }
            
            // 内存性能测试
            function testMemory() {
                return new Promise(resolve => {
                    // 记录开始时间
                    const startTime = performance.now();
                    let arraySize = 100000;
                    let totalArrays = 0;
                    const arrays = [];
                    
                    // 内存测试函数
                    function testMemoryStep() {
                        try {
                            // 分配内存
                            const array = new Uint32Array(arraySize);
                            // 写入数据
                            for (let i = 0; i < arraySize; i++) {
                                array[i] = i;
                            }
                            arrays.push(array);
                            totalArrays++;
                            
                            // 更新进度
                            const elapsed = performance.now() - startTime;
                            const progress = Math.min(Math.floor((elapsed / 5000) * 100), 100);
                            memoryProgress.style.width = `${progress}%`;
                            
                            // 持续5秒钟的测试或直到内存不足
                            if (elapsed < 5000 && totalArrays < 50) {
                                setTimeout(testMemoryStep, 50);
                            } else {
                                // 释放内存
                                arrays.length = 0;
                                
                                // 计算得分
                                const score = Math.min(Math.floor((totalArrays * 2)), 100);
                                
                                // 估算可用内存
                                const estimatedMemory = ((totalArrays * arraySize * 4) / (1024 * 1024)).toFixed(1);
                                
                                // 保存结果
                                testResults.memory.score = score;
                                testResults.memory.available = `${estimatedMemory} MB`;
                                testResults.memory.speed = `${(totalArrays / (elapsed / 1000)).toFixed(1)} MB/秒`;
                                
                                // 更新UI
                                memoryScore.textContent = score;
                                availableMemory.textContent = testResults.memory.available;
                                memorySpeed.textContent = testResults.memory.speed;
                                
                                // 恢复显示
                                memoryTesting.classList.add('hidden');
                                memoryTestContent.classList.remove('hidden');
                                
                                // 更新状态
                                memoryStatus.className = getScoreBadgeClass(score);
                                memoryStatus.textContent = getScoreText(score);
                                
                                showToast("内存性能测试完成");
                                resolve();
                            }
                        } catch (e) {
                            // 内存不足时结束测试
                            arrays.length = 0;
                            const elapsed = performance.now() - startTime;
                            const score = Math.min(Math.floor((totalArrays * 2)), 100);
                            
                            memoryScore.textContent = score;
                            memoryTesting.classList.add('hidden');
                            memoryTestContent.classList.remove('hidden');
                            
                            memoryStatus.className = getScoreBadgeClass(score);
                            memoryStatus.textContent = getScoreText(score);
                            
                            showToast("内存性能测试完成");
                            resolve();
                        }
                    }
                    
                    testMemoryStep();
                });
            }
            
            // 显卡性能测试
            function testGPU() {
                return new Promise(resolve => {
                    // 初始化测试参数
                    const startTime = performance.now();
                    gpuTestFrameCount = 0;
                    gpuTestLastTime = 0;
                    let fps = 0;
                    
                    // 创建测试对象
                    createGpuTestObjects(50); // 创建50个测试对象
                    
                    // 测试持续时间 (8秒)
                    const testDuration = 8000;
                    
                    // 更新进度函数
                    function updateProgress() {
                        const elapsed = performance.now() - startTime;
                        return Math.min(Math.floor((elapsed / testDuration) * 100), 100);
                    }
                    
                    // 渲染函数
                    function render(timestamp) {
                        // 计算帧率
                        if (gpuTestLastTime === 0) {
                            gpuTestLastTime = timestamp;
                        }
                        const deltaTime = timestamp - gpuTestLastTime;
                        fps = Math.round(1000 / deltaTime);
                        gpuTestLastTime = timestamp;
                        
                        // 更新并渲染对象
                        updateAndRenderGpuObjects();
                        
                        // 显示当前帧率
                        gpuCanvasCtx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                        gpuCanvasCtx.fillRect(10, 10, 50, 20);
                        gpuCanvasCtx.fillStyle = 'white';
                        gpuCanvasCtx.font = '12px sans-serif';
                        gpuCanvasCtx.textAlign = 'left';
                        gpuCanvasCtx.textBaseline = 'top';
                        gpuCanvasCtx.fillText(`${fps} FPS`, 15, 12);
                        
                        // 更新进度
                        const progress = updateProgress();
                        gpuProgress.style.width = `${progress}%`;
                        
                        // 继续测试或结束
                        const elapsed = performance.now() - startTime;
                        gpuTestFrameCount++;
                        
                        if (elapsed < testDuration) {
                            gpuTestAnimationId = requestAnimationFrame(render);
                        } else {
                            // 计算平均帧率
                            const averageFps = Math.round(gpuTestFrameCount / (testDuration / 1000));
                            
                            // 计算得分 (基于平均帧率)
                            const score = Math.min(Math.floor(averageFps), 100);
                            
                            // 保存结果
                            testResults.gpu.score = score;
                            testResults.gpu.fps = `${averageFps} FPS`;
                            testResults.gpu.performance = score >= 60 ? "优秀" : score >= 30 ? "良好" : "一般";
                            
                            // 更新UI
                            gpuScore.textContent = score;
                            gpuFps.textContent = testResults.gpu.fps;
                            gpuRenderPerformance.textContent = testResults.gpu.performance;
                            
                            // 恢复显示
                            cancelAnimationFrame(gpuTestAnimationId);
                            gpuTesting.classList.add('hidden');
                            gpuTestContent.classList.remove('hidden');
                            
                            // 绘制最终状态
                            clearGpuCanvas();
                            gpuCanvasCtx.fillStyle = '#f3f4f6';
                            gpuCanvasCtx.fillRect(0, 0, gpuCanvas.width, gpuCanvas.height);
                            gpuCanvasCtx.fillStyle = '#6b7280';
                            gpuCanvasCtx.textAlign = 'center';
                            gpuCanvasCtx.textBaseline = 'middle';
                            gpuCanvasCtx.font = '14px sans-serif';
                            gpuCanvasCtx.fillText(`显卡性能测试完成: ${averageFps} FPS`, gpuCanvas.width / 2, gpuCanvas.height / 2);
                            
                            // 更新状态
                            gpuStatus.className = getScoreBadgeClass(score);
                            gpuStatus.textContent = getScoreText(score);
                            
                            showToast("显卡性能测试完成");
                            resolve();
                        }
                    }
                    
                    // 开始渲染测试
                    gpuTestAnimationId = requestAnimationFrame(render);
                });
            }
            
            // 创建显卡测试对象
            function createGpuTestObjects(count) {
                gpuTestObjects = [];
                const width = gpuCanvas.width;
                const height = gpuCanvas.height;
                
                for (let i = 0; i < count; i++) {
                    // 随机生成对象属性
                    gpuTestObjects.push({
                        x: Math.random() * width,
                        y: Math.random() * height,
                        size: 5 + Math.random() * 20,
                        speedX: (Math.random() - 0.5) * 3,
                        speedY: (Math.random() - 0.5) * 3,
                        color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.1
                    });
                }
            }
            
            // 更新并渲染显卡测试对象
            function updateAndRenderGpuObjects() {
                if (!gpuCanvasCtx) return;
                
                const width = gpuCanvas.width;
                const height = gpuCanvas.height;
                
                // 清除画布
                clearGpuCanvas();
                
                // 填充背景
                gpuCanvasCtx.fillStyle = '#f8fafc';
                gpuCanvasCtx.fillRect(0, 0, width, height);
                
                // 更新并绘制每个对象
                gpuTestObjects.forEach(obj => {
                    // 更新位置
                    obj.x += obj.speedX;
                    obj.y += obj.speedY;
                    
                    // 边界检测
                    if (obj.x < 0 || obj.x > width) obj.speedX = -obj.speedX;
                    if (obj.y < 0 || obj.y > height) obj.speedY = -obj.speedY;
                    
                    // 更新旋转
                    obj.rotation += obj.rotationSpeed;
                    
                    // 保存当前状态
                    gpuCanvasCtx.save();
                    
                    // 移动到对象位置
                    gpuCanvasCtx.translate(obj.x, obj.y);
                    
                    // 旋转
                    gpuCanvasCtx.rotate(obj.rotation);
                    
                    // 绘制对象
                    gpuCanvasCtx.fillStyle = obj.color;
                    gpuCanvasCtx.beginPath();
                    gpuCanvasCtx.arc(0, 0, obj.size, 0, Math.PI * 2);
                    gpuCanvasCtx.fill();
                    
                    // 绘制旋转线
                    gpuCanvasCtx.strokeStyle = 'rgba(0, 0, 0, 0.3)';
                    gpuCanvasCtx.lineWidth = 2;
                    gpuCanvasCtx.beginPath();
                    gpuCanvasCtx.moveTo(0, 0);
                    gpuCanvasCtx.lineTo(obj.size, 0);
                    gpuCanvasCtx.stroke();
                    
                    // 恢复状态
                    gpuCanvasCtx.restore();
                });
            }
            
            // 网络速度测试
            function testNetwork() {
                return new Promise(resolve => {
                    // 记录开始时间
                    const startTime = performance.now();
                    
                    // 测试延迟
                    const latencyStart = performance.now();
                    const latencyImg = new Image();
                    latencyImg.src = `https://zhu18.github.io/games/images/1x1.png?random=${Math.random()}`;
                    
                    latencyImg.onload = () => {
                        const latency = Math.floor(performance.now() - latencyStart);
                        testResults.network.latency = `${latency} ms`;
                        networkLatency.textContent = testResults.network.latency;
                        
                        // 开始下载速度测试
                        const downloadSize = 1024 * 1024 * 5; // 5MB测试文件
                        const downloadStart = performance.now();
                        const downloadImg = new Image();
                        downloadImg.src = `https://zhu18.github.io/games/images/HUD.png?random=${Math.random()}`; // 约5MB的图片
                        
                        // 进度更新函数
                        function updateProgress() {
                            const elapsed = performance.now() - startTime;
                            const progress = Math.min(Math.floor((elapsed / 9000) * 100), 90); // 最高90%，留10%给最终计算
                            networkProgress.style.width = `${progress}%`;
                            
                            if (networkTesting.classList.contains('hidden') === false) {
                                requestAnimationFrame(updateProgress);
                            }
                        }
                        
                        updateProgress();
                        
                        downloadImg.onload = () => {
                            const downloadTime = performance.now() - downloadStart;
                            // 计算下载速度 (MB/s)
                            const speed = ((downloadSize / (1024 * 1024)) / (downloadTime / 1000)).toFixed(2);
                            
                            // 计算得分
                            const score = Math.min(Math.floor(speed * 5), 100);
                            
                            // 保存结果
                            testResults.network.score = score;
                            testResults.network.download = `${speed} MB/s`;
                            
                            // 更新UI
                            networkScore.textContent = score;
                            downloadSpeed.textContent = testResults.network.download;
                            
                            // 完成进度
                            networkProgress.style.width = '100%';
                            
                            // 恢复显示
                            networkTesting.classList.add('hidden');
                            networkTestContent.classList.remove('hidden');
                            
                            // 更新状态
                            networkStatus.className = getScoreBadgeClass(score);
                            networkStatus.textContent = getScoreText(score);
                            
                            showToast("网络速度测试完成");
                            resolve();
                        };
                        
                        downloadImg.onerror = () => {
                            // 下载出错时的处理
                            networkScore.textContent = 0;
                            downloadSpeed.textContent = "测试失败";
                            
                            networkTesting.classList.add('hidden');
                            networkTestContent.classList.remove('hidden');
                            
                            networkStatus.className = 'result-badge bg-gray-100 text-gray-600';
                            networkStatus.textContent = '测试失败';
                            
                            showToast("网络测试失败", "warning");
                            resolve();
                        };
                    };
                    
                    latencyImg.onerror = () => {
                        // 延迟测试失败
                        networkScore.textContent = 0;
                        networkLatency.textContent = "测试失败";
                        
                        networkTesting.classList.add('hidden');
                        networkTestContent.classList.remove('hidden');
                        
                        networkStatus.className = 'result-badge bg-gray-100 text-gray-600';
                        networkStatus.textContent = '测试失败';
                        
                        showToast("网络测试失败", "warning");
                        resolve();
                    };
                });
            }
            
            // 电池状态测试
            function testBattery() {
                return new Promise(resolve => {
                    // 模拟进度更新
                    let progress = 0;
                    function updateBatteryProgress() {
                        progress += 1;
                        batteryProgress.style.width = `${progress}%`;
                        
                        if (progress < 100 && batteryTesting.classList.contains('hidden') === false) {
                            setTimeout(updateBatteryProgress, 25);
                        }
                    }
                    
                    updateBatteryProgress();
                    
                    // 检查浏览器是否支持电池API
                    if ('getBattery' in navigator) {
                        navigator.getBattery().then(battery => {
                            // 获取电池信息
                            const level = Math.floor(battery.level * 100);
                            const isCharging = battery.charging ? "充电中" : "放电中";
                            const s=`charging:${battery.charging}
                            chargingTime:${battery.chargingTime}
                            dischargingTime:${battery.dischargingTime}
                            level:${battery.level}
                            chargingTime:${battery.chargingTime}
                            `
                            alert(s)
                            // 估算续航时间
                            let estimate = "无法估算";
                            if (!battery.charging && battery.dischargingTime !== Infinity) {
                                const hours = Math.floor(battery.dischargingTime / 3600);
                                const minutes = Math.floor((battery.dischargingTime % 3600) / 60);
                                estimate = `${hours}小时${minutes}分钟`;
                            } else if (battery.charging && battery.chargingTime !== Infinity) {
                                const minutes = Math.floor(battery.chargingTime / 60);
                                estimate = `充满需${minutes}分钟`;
                            }
                            
                            // 估算健康状态
                            const health = "良好"; // 浏览器无法直接获取电池健康状态，这里使用固定值
                            
                            // 计算得分 (基于电量和健康状况估算)
                            let score = level;
                            if (battery.charging) score += 10;
                            score = Math.min(score, 100);
                            
                            // 保存结果
                            testResults.battery.score = score;
                            testResults.battery.level = `${level}%`;
                            testResults.battery.state = isCharging;
                            testResults.battery.estimate = estimate;
                            testResults.battery.health = health;
                            
                            // 更新UI
                            batteryScore.textContent = score;
                            batteryLevel.textContent = testResults.battery.level;
                            batteryState.textContent = testResults.battery.state;
                            batteryEstimate.textContent = testResults.battery.estimate;
                            batteryHealth.textContent = testResults.battery.health;
                            
                            // 恢复显示
                            batteryTesting.classList.add('hidden');
                            batteryTestContent.classList.remove('hidden');
                            
                            // 更新状态
                            batteryStatus.className = getScoreBadgeClass(score);
                            batteryStatus.textContent = getScoreText(score);
                            
                            showToast("电池状态检测完成");
                            resolve();
                        }).catch(error => {
                            handleBatteryTestError();
                            resolve();
                        });
                    } else {
                        // 浏览器不支持电池API，使用模拟数据
                        handleBatteryTestError();
                        resolve();
                    }
                });
            }
            
            // 处理电池测试错误
            function handleBatteryTestError() {
                // 模拟结果
                testResults.battery.score = 70;
                testResults.battery.level = "未知";
                testResults.battery.state = "不支持检测";
                testResults.battery.estimate = "无法获取";
                testResults.battery.health = "未知";
                
                // 更新UI
                batteryScore.textContent = testResults.battery.score;
                batteryLevel.textContent = testResults.battery.level;
                batteryState.textContent = testResults.battery.state;
                batteryEstimate.textContent = testResults.battery.estimate;
                batteryHealth.textContent = testResults.battery.health;
                
                // 恢复显示
                batteryTesting.classList.add('hidden');
                batteryTestContent.classList.remove('hidden');
                
                // 更新状态
                batteryStatus.className = getScoreBadgeClass(testResults.battery.score);
                batteryStatus.textContent = getScoreText(testResults.battery.score);
                
                showToast("电池状态检测完成（部分信息不支持）", "warning");
            }
            
            // 计算总得分
            function calculateTotalScore() {
                // 计算加权总分（新增显卡权重）
                const total = Math.floor(
                    testResults.cpu.score * 0.25 +
                    testResults.memory.score * 0.2 +
                    testResults.gpu.score * 0.25 +
                    testResults.network.score * 0.15 +
                    testResults.battery.score * 0.15
                );
                
                // 更新UI
                totalScore.textContent = total;
                
                // 设置评分描述
                let description = "";
                if (total >= 90) {
                    description = "优秀！您的设备性能非常出色";
                } else if (total >= 70) {
                    description = "良好！您的设备性能表现不错";
                } else if (total >= 50) {
                    description = "一般！您的设备性能基本满足日常需求";
                } else if (total >= 30) {
                    description = "较差！您的设备性能可能影响使用体验";
                } else {
                    description = "落后！您的设备性能较低";
                }
                
                scoreDesc.textContent = description;
                
                // 恢复按钮状态
                startTestBtn.disabled = false;
                startTestBtn.innerHTML = '<i class="fa fa-refresh mr-2"></i> 重新检测';
                
                showToast("所有测试完成，已生成性能报告");
            }
            
            // 显示性能图表
            function displayPerformanceChart() {
                performanceChartContainer.classList.remove('hidden');
                
                const ctx = document.getElementById('performanceChart').getContext('2d');
                
                // 如果已有图表，销毁它
                if (performanceChart) {
                    performanceChart.destroy();
                }
                
                // 创建新图表
                performanceChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: ['CPU性能', '内存性能', '显卡性能', '网络速度', '电池状态'],
                        datasets: [{
                            label: '性能得分',
                            data: [
                                testResults.cpu.score,
                                testResults.memory.score,
                                testResults.gpu.score,
                                testResults.network.score,
                                testResults.battery.score
                            ],
                            backgroundColor: 'rgba(59, 130, 246, 0.2)',
                            borderColor: 'rgba(59, 130, 246, 1)',
                            pointBackgroundColor: [
                                'rgba(59, 130, 246, 1)',
                                'rgba(16, 185, 129, 1)',
                                'rgba(139, 92, 246, 1)',
                                'rgba(245, 158, 11, 1)',
                                'rgba(239, 68, 68, 1)'
                            ],
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(59, 130, 246, 1)'
                        }]
                    },
                    options: {
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20
                                }
                            }
                        },
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // 根据分数获取徽章样式
            function getScoreBadgeClass(score) {
                if (score >= 80) {
                    return 'result-badge bg-green-100 text-green-700';
                } else if (score >= 60) {
                    return 'result-badge bg-blue-100 text-blue-700';
                } else if (score >= 40) {
                    return 'result-badge bg-yellow-100 text-yellow-700';
                } else {
                    return 'result-badge bg-red-100 text-red-700';
                }
            }
            
            // 根据分数获取描述文本
            function getScoreText(score) {
                if (score >= 80) {
                    return '优秀';
                } else if (score >= 60) {
                    return '良好';
                } else if (score >= 40) {
                    return '一般';
                } else {
                    return '较差';
                }
            }
            
            // 显示提示信息
            function showToast(message, type = 'success') {
                // 检查是否已有toast，如有则移除
                const existingToast = document.querySelector('#toast');
                if (existingToast) {
                    existingToast.remove();
                }
                
                // 创建新toast
                const toast = document.createElement('div');
                toast.id = 'toast';
                toast.className = 'fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-dark text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 z-50 opacity-0 transition-all duration-300';
                
                let icon = 'fa-check-circle text-green-400';
                if (type === 'warning') {
                    icon = 'fa-exclamation-triangle text-yellow-400';
                } else if (type === 'error') {
                    icon = 'fa-times-circle text-red-400';
                }
                
                toast.innerHTML = `
                    <i class="fa ${icon}"></i>
                    <span>${message}</span>
                `;
                
                document.body.appendChild(toast);
                
                // 显示toast
                setTimeout(() => {
                    toast.classList.remove('opacity-0');
                    toast.classList.add('opacity-100');
                }, 100);
                
                // 3秒后隐藏
                setTimeout(() => {
                    toast.classList.remove('opacity-100');
                    toast.classList.add('opacity-0');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 3000);
            }
        });
    </script>
</body>
</html>
